/*! toolbox-challenge 07-12-2014 */
"use strict";$(document).ready(function(){function a(a){o.empty();var b=_.shuffle(a),d=b.slice(0,8),e=[];_.forEach(d,function(a){e.push(_.clone(a)),e.push(_.clone(a))}),e=_.shuffle(e);var f,g=$(document.createElement("div"));_.forEach(e,function(a,b){b>0&&b%4==0&&(o.append(g),g=$(document.createElement("div"))),f=$(document.createElement("img")),f.attr({src:"img/tile-back.png",alt:"image of tile "+a.tileNum}),f.data("tile",a),g.append(f)}),o.append(g),j=null,k=0,m=8,n=!1,h=null,$("#game-board img").click(c)}function b(){window.clearInterval(h),$("#elapsed-seconds").text("Elapsed Time: 0s");var a=_.now();h=window.setInterval(function(){var b=Math.floor((_.now()-a)/1e3);$("#elapsed-seconds").text("Elapsed Time: "+b+"s")},1e3)}function c(){if(!$(this).data("tile").flipped)if(null==j)j=$(this),e(j);else{var a=$(this);e(a),n=f(j.data("tile"),a.data("tile")),n?(++k,--m,$("#matches").text("Matches: "+k),$("#remaining-matches").text("Remaining: "+m),j=null,8==k&&d()):(++l,$("#missed").text("Missed: "+l),window.setTimeout(function(){e(j),e(a),j=null},1e3))}}function d(){window.clearInterval(h),$("main").css("opacity",.4),$(".game-won-message").hide().fadeIn(1e3,function(){$(".crowd-cheer").trigger("play")}),$("#close-message-button").click(function(){$(".game-won-message").hide(),$("main").css("opacity",1)})}function e(a){var b=a.data("tile");a.fadeOut(100,function(){b.flipped?a.attr("src","img/tile-back.png"):a.attr("src",b.src),b.flipped=!b.flipped,a.fadeIn(100)})}function f(a,b){return a.tileNum==b.tileNum}var g,h,i=[],j=null,k=0,l=0,m=8,n=!1,o=$("#game-board");for(g=1;32>=g;++g)i.push({tileNum:g,src:"img/tile"+g+".jpg",flipped:!1,isMatched:!1});$("#startButton").click(function(){window.clearInterval(h),$("#matches").text("Matches: 0"),$("#missed").text("Missed: 0"),$("#remaining-matches").text("Remaining: 8"),a(i),b()}),$("#game-info-button").click(function(){$("#game-info-modal").modal()})});